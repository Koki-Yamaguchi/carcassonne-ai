## カルカソンヌの盤面評価器

## 概要

カルカソンヌ AI の最初の実装として、「あるプレイヤーにとっての盤面の評価値」を計算できるようにして、自分と相手のその評価値の差分が最大になる盤面に遷移する手を打つ、というものを作る。
そのために、最終的に単一の数値を返すような盤面評価器を書く。

## 現状のアルゴリズム

f: = Σf_v + m_v

### 単独でミープルがのっている地形の良さ f_v

- 道、都市、修道院は f_v := cur_v + comp_p \* (add_v + m_v)
- 草原は f_v := cur_v + cc \* 3

### 現時点でのその地形の得点 cur_v

- cur_v := 現時点でのその地形の得点

### 完成で見込める追加の得点 add_v

- 道、修道院: 完成で追加される得点は基本的に 1 点なので add_v := 1
- 都市: 現時点での得点と最後に配置するタイル分の 2 点を足したもの add_v := cur_v + 2

### 地形の完成確率 comp_p

- 道は終端タイルを道の両端につけれる確率
- ただし、あと一枚でループができる場合や、道の両端が隣接していてカーブ系のタイル 2 枚やストレート系とカーブ系 1 枚ずつでループにして完成することができる場合は終端を要求しないので完成確率が高い

- 都市と修道院は完成のために必要なマスを全て適当に埋めることができる確率 comp_p := Π fill_p
- 都市と道は肥大化による破壊を考慮して、破壊されやすい場合は少し評価を下げる (道は未実装)

### ある箇所にタイルを置ける確率 fill_p

- ある箇所にタイルを置ける確率は、現時点でそこに置けるタイルの枚数と、その周囲 4 マスのいずれかにタイルを置かれる場合に置けるタイルが何枚に減少するかなどから、良い具合に計算する

### 都市や道にお互いのミープルが 1 体以上のっていて、相乗りの形になっている場合の地形の良さ f_v

- 現状ではタイル一枚で 2 ~ 4 つの地形が繋がるような「穴」が 1 つのときのみ考慮する (穴が 2 つ以上あるときは複雑) 。穴にタイルが入る確率と、穴にタイルが入ったときに得点がどう変わるか (+ ミープル数が同じではないときは都市乗っ取り完成ボーナスも足す) で適当に計算する

### 残っているミープルの価値 m_v

- 現状は適当にやっていて、特に最後の一体の価値を高くして簡単に全駒しないようにする
- 回収の目処がどれくらいあるかとか、ミープルがなくて困る盤面かどうかなどを考慮に入れたい (未実装)

### ニーズの重複

- 道ばかり、都市ばかり、みたいな状態とか、複数の地形で同じタイルを待つような状態は総合評価を下げるなどしたい (未実装)

### 相乗りされない確率 safe_p

- もし実装できるなら f_v にかける (未実装)

### 草原内に追加で完成する街として期待できる数 cc

- 既にある未完成の都市の完成確率で重み付けして適当に計算できそう。道などでどれくらい草原が閉じられているかも大事 (未実装)

